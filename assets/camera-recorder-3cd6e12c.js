import{o as e,j as s,q as o,e as Z,y as w,au as ne,d as ie,av as se,aw as re,T as ae,n as t,E as _,w as a,F as ce,r as le,A as de,v as A,m,k as c,z as U,ag as R,s as ue,x as _e}from"./index-9f81791e.js";import{_ as me}from"./c-select-f5bfdcd9.js";import{_ as pe}from"./c-alert-e8d62558.js";import"./c-label.vue_vue_type_script_setup_true_lang-d4bb2fcf.js";const ve={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},he=o("path",{fill:"currentColor",d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12M8 9h8v10H8V9m7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5Z"},null,-1),fe=[he];function ge(u,i){return e(),s("svg",ve,fe)}const ke={name:"mdi-delete-outline",render:ge},we={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ye=o("path",{fill:"currentColor",d:"M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7l7-7Z"},null,-1),$e=[ye];function be(u,i){return e(),s("svg",we,$e)}const xe={name:"mdi-download",render:be},Ce={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Re=o("path",{fill:"currentColor",d:"M19 12c0 3.86-3.14 7-7 7s-7-3.14-7-7s3.14-7 7-7s7 3.14 7 7Z"},null,-1),Me=[Re];function Se(u,i){return e(),s("svg",Ce,Me)}const Ve={name:"mdi-record",render:Se},Be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},He=o("path",{fill:"currentColor",d:"M8 5.14v14l11-7l-11-7Z"},null,-1),Ie=[He];function je(u,i){return e(),s("svg",Be,Ie)}const Ae={name:"mdi-play",render:je},Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ze=o("path",{fill:"currentColor",d:"M14 19h4V5h-4M6 19h4V5H6v14Z"},null,-1),De=[Ze];function Ee(u,i){return e(),s("svg",Ue,De)}const Ne={name:"mdi-pause",render:Ee},Te={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Le=o("path",{fill:"currentColor",d:"M17 10.5V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3.5l4 4v-11l-4 4Z"},null,-1),Pe=[Le];function qe(u,i){return e(),s("svg",Te,Pe)}const Ye={name:"mdi-video",render:qe},ze={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Fe=o("path",{fill:"currentColor",d:"M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m8 3a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5m0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3Z"},null,-1),Ge=[Fe];function Oe(u,i){return e(),s("svg",ze,Ge)}const We={name:"mdi-camera",render:Oe};function Je({stream:u}){const i=Z(()=>MediaRecorder.isTypeSupported("video/webm")),n=w(null),x=w([]),M=ne(),l=w("stopped"),p=()=>{const g=new Blob(x.value,{type:"video/webm"}),B=URL.createObjectURL(g);return x.value=[],B};return{isRecordingSupported:i,startRecording:()=>{i.value&&u.value&&l.value==="stopped"&&(n.value=new MediaRecorder(u.value,{mimeType:"video/webm"}),n.value.ondataavailable=g=>{g.data.size>0&&x.value.push(g.data)},n.value.onstop=()=>{M.trigger(p())},n.value.state==="inactive"&&(n.value.start(),l.value="recording"))},stopRecording:()=>{i.value&&n.value&&l.value!=="stopped"&&(n.value.stop(),l.value="stopped")},pauseRecording:()=>{i.value&&n.value&&l.value==="recording"&&(n.value.pause(),l.value="paused")},resumeRecording:()=>{i.value&&n.value&&l.value==="paused"&&(n.value.resume(),l.value="recording")},recordingState:l,onRecordAvailable:M.on}}const Ke={key:1,"mt-4":"",flex:"","justify-center":""},Qe={flex:"","flex-col":"","gap-2":""},Xe={key:0,"mt-3":"",flex:"","justify-center":""},et={key:1},tt={"my-2":""},ot={flex:"","items-center":"","justify-between":"","gap-2":""},nt={"mr-2":""},it={key:0,flex:"","justify-center":"","gap-2":""},st={"mr-2":""},rt={"mr-2":""},at={"mr-2":""},ct={"mr-2":""},lt={key:1,italic:"","op-60":""},dt={grid:"","grid-cols-2":"","mt-5":"","gap-2":""},ut=["src"],_t=["src"],mt={flex:"","items-center":"","justify-between":""},pt={"font-bold":""},vt={flex:"","gap-2":""},yt=ie({__name:"camera-recorder",setup(u){const{videoInputs:i,audioInputs:n,permissionGranted:x,isSupported:M,ensurePermissions:l}=se({requestPermissions:!0,constraints:{video:!0,audio:!0},onUpdated(){q()}}),p=w(),$=w([]),f=w(i.value[0]?.deviceId),v=w(n.value[0]?.deviceId),V=w(!1),{stream:g,start:B,enabled:H}=re({constraints:Z(()=>({video:{deviceId:f.value},...v.value?{audio:{deviceId:v.value}}:{}})),autoSwitch:!0}),{isRecordingSupported:D,onRecordAvailable:E,startRecording:N,stopRecording:T,pauseRecording:L,recordingState:S,resumeRecording:P}=Je({stream:g});E(r=>{$.value.unshift({type:"video",value:r,createdAt:new Date})});function q(){(A.isNil(f)||!i.value.find(r=>r.deviceId===f.value))&&(f.value=i.value[0]?.deviceId),(A.isNil(n)||!n.value.find(r=>r.deviceId===v.value))&&(v.value=n.value[0]?.deviceId)}function Y(){if(!p.value)return;const r=document.createElement("canvas");r.width=p.value.videoWidth,r.height=p.value.videoHeight,r.getContext("2d")?.drawImage(p.value,0,0);const k=r.toDataURL("image/png");$.value.unshift({type:"image",value:k,createdAt:new Date})}ae(()=>{p.value&&g.value&&(p.value.srcObject=g.value)});async function z(){try{await l()}catch{V.value=!0}}function F({type:r,value:k,createdAt:b}){const C=document.createElement("a");C.href=k,C.download=`${r}-${b.getTime()}.${r==="image"?"png":"webm"}`,C.click()}return(r,k)=>{const b=de,C=pe,h=_e,I=me,G=We,O=Ye,W=Ne,J=Ae,K=Ve,Q=xe,X=ke;return e(),s("div",null,[t(M)?t(x)?(e(),_(b,{key:2},{default:a(()=>[o("div",Qe,[c(I,{value:t(f),"onUpdate:value":k[0]||(k[0]=d=>U(f)?f.value=d:null),"label-position":"left","label-width":"60px",label:"Video:",options:t(i).map(({deviceId:d,label:y})=>({value:d,label:y})),placeholder:"Select camera"},null,8,["value","options"]),t(v)&&t(n).length>0?(e(),_(I,{key:0,value:t(v),"onUpdate:value":k[1]||(k[1]=d=>U(v)?v.value=d:null),label:"Audio:","label-position":"left","label-width":"60px",options:t(n).map(({deviceId:d,label:y})=>({value:d,label:y})),placeholder:"Select microphone"},null,8,["value","options"])):R("",!0)]),t(H)?(e(),s("div",et,[o("div",tt,[o("video",{ref_key:"video",ref:p,autoplay:"",controls:"",playsinline:"","max-h-full":"","w-full":""},null,512)]),o("div",ot,[c(h,{disabled:!t(H),onClick:Y},{default:a(()=>[o("span",nt,[c(G)]),m(" Take screenshot ")]),_:1},8,["disabled"]),t(D)?(e(),s("div",it,[t(S)==="stopped"?(e(),_(h,{key:0,onClick:t(N)},{default:a(()=>[o("span",st,[c(O)]),m(" Start recording ")]),_:1},8,["onClick"])):R("",!0),t(S)==="recording"?(e(),_(h,{key:1,onClick:t(L)},{default:a(()=>[o("span",rt,[c(W)]),m(" Pause ")]),_:1},8,["onClick"])):R("",!0),t(S)==="paused"?(e(),_(h,{key:2,onClick:t(P)},{default:a(()=>[o("span",at,[c(J)]),m(" Resume ")]),_:1},8,["onClick"])):R("",!0),t(S)!=="stopped"?(e(),_(h,{key:3,type:"error",onClick:t(T)},{default:a(()=>[o("span",ct,[c(K)]),m(" Stop ")]),_:1},8,["onClick"])):R("",!0)])):(e(),s("div",lt," Video recording is not supported in your browser "))])])):(e(),s("div",Xe,[c(h,{type:"primary",onClick:t(B)},{default:a(()=>[m(" Start webcam ")]),_:1},8,["onClick"])]))]),_:1})):(e(),_(b,{key:1,"text-center":""},{default:a(()=>[m(" You need to grant permission to use your camera and microphone "),t(V)?(e(),_(C,{key:0,"mt-4":"","text-left":""},{default:a(()=>[m(" Your browser has blocked permission request or does not support it. You need to grant permission manually in your browser settings (usually the lock icon in the address bar). ")]),_:1})):(e(),s("div",Ke,[c(h,{onClick:z},{default:a(()=>[m(" Grant permission ")]),_:1})]))]),_:1})):(e(),_(b,{key:0},{default:a(()=>[m(" Your browser does not support recording video from camera ")]),_:1})),o("div",dt,[(e(!0),s(ce,null,le(t($),({type:d,value:y,createdAt:ee},j)=>(e(),_(b,{key:j},{default:a(()=>[d==="image"?(e(),s("img",{key:0,src:y,"max-h-full":"","w-full":"",alt:"screenshot"},null,8,ut)):(e(),s("video",{key:1,src:y,controls:"","max-h-full":"","w-full":""},null,8,_t)),o("div",mt,[o("div",pt,ue(d==="image"?"Screenshot":"Video"),1),o("div",vt,[c(h,{onClick:te=>F({type:d,value:y,createdAt:ee})},{default:a(()=>[c(Q)]),_:2},1032,["onClick"]),c(h,{onClick:te=>$.value=t($).filter((ht,oe)=>oe!==j)},{default:a(()=>[c(X)]),_:2},1032,["onClick"])])])]),_:2},1024))),128))])])}}});export{yt as default};
